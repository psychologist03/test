<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Опросник Д. Олвеуса</title>
<style>
body { font-family: Arial; max-width: 800px; margin: 10px auto; background: #f8f9fa; padding: 15px; border-radius: 10px; }
h2 { text-align: center; font-size: 1.4em; }
.question { margin-bottom: 12px; background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
label { display: block; margin: 5px 0; font-size: 0.9em; }
button { display: block; margin: 20px auto; padding: 12px 30px; font-size: 1em; background-color: #007BFF; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; max-width: 300px; }
button:hover { background-color: #0056b3; }
#result { display: none; background: #e9ecef; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; }
</style>
</head>
<body>

<h2>Опросник Д. Олвеуса</h2>

<div class="info-block">
  <div>
    <label for="group">Группа:</label>
    <input type="text" id="group" placeholder="Группа" required>
  </div>
  <div>
    <label for="age">Возраст:</label>
    <input type="number" id="age" min="5" max="30" placeholder="Возраст" required>
  </div>
  <div>
    <label for="gender">Пол:</label>
    <select id="gender" required>
      <option value="">Выберите...</option>
      <option value="Мужской">Мужской</option>
      <option value="Женский">Женский</option>
    </select>
  </div>
</div>

<form id="quizForm">
  <div id="questions"></div>
  <button type="button" onclick="calculateResult()">Отправить результат</button>
</form>

<div id="result"></div>

<script>
const questions = [
  "Я кого-то обозвал.",
  "Я с кем-то специально не разговаривал.",
  "Я нанес кому-то физический вред, например, толкнул или ударил.",
  "Я распространял о ком-то сплетни.",
  "Я угрожал.",
  "Я украл или испортил чьи-то вещи.",
  "Меня обзывали.",
  "Обо мне распространяли сплетни.",
  "Никто не хочет сидеть со мной или проводить свободное время.",
  "У меня украли вещи.",
  "Мне нанесли физический вред (ударили, толкнули).",
  "Никто не разговаривает со мной.",
  "Мне угрожали."
];

const answerOptions = [
  "Никогда не было",
  "Было раз или два",
  "Бывает иногда",
  "Бывает раз в неделю",
  "Бывает несколько раз в неделю"
];

const activeRange = [0,1,2,3,4,5];
const passiveRange = [6,7,8,9,10,11,12];

window.onload = function() {
  const container = document.getElementById("questions");
  questions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `<strong>${i+1}. ${q}</strong>`;
    answerOptions.forEach((opt, idx) => {
      div.innerHTML += `<label><input type="radio" name="q${i}" value="${idx}" required> ${opt}</label>`;
    });
    container.appendChild(div);
  });
};

function interpretNumeric(value) {
  if (value < 1) return "слабо выражено";
  if (value < 2.5) return "умеренно выражено";
  return "ярко выражено (регулярное проявление)";
}

async function calculateResult() {
  const group = document.getElementById("group").value.trim();
  const age = document.getElementById("age").value.trim();
  const gender = document.getElementById("gender").value;

  let activeSum = 0, passiveSum = 0;
  let activeCount = 0, passiveCount = 0;

  for (let i = 0; i < questions.length; i++) {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    if (!selected) {
      alert("Пожалуйста, ответьте на все вопросы!");
      return;
    }
    const value = parseInt(selected.value);
    if (activeRange.includes(i)) { activeSum += value; activeCount++; }
    if (passiveRange.includes(i)) { passiveSum += value; passiveCount++; }
  }

  const activeAvg = parseFloat((activeSum / activeCount).toFixed(2));
  const passiveAvg = parseFloat((passiveSum / passiveCount).toFixed(2));

  const activeText = interpretNumeric(activeAvg);
  const passiveText = interpretNumeric(passiveAvg);

  const data = {
    group,
    age,
    gender,
    activeScore: `${activeAvg} — ${activeText}`,
    passiveScore: `${passiveAvg} — ${passiveText}`
  };

  // Отправка данных в Apps Script
  try {
    await fetch("https://script.google.com/macros/s/ВАШ_ID/exec", {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
  } catch (error) {
    console.error("Ошибка при отправке: ", error);
  }

  document.getElementById("quizForm").reset();
  document.getElementById("result").style.display = "block";
  document.getElementById("result").innerHTML = `<h3>Спасибо за участие!</h3><p>Ваш ответ принят.</p>`;
}
</script>
</body>
</html>
